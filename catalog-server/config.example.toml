# Pezzottify Catalog Server Configuration
# Copy this file to config.toml and customize for your deployment.
# Values here override CLI arguments.

# Core settings
db_dir = "/data/db"
media_path = "/data/media"
port = 3001
metrics_port = 9091
logging_level = "path"
content_cache_age_sec = 60
frontend_dir_path = "/app/web"

# Downloader service URL (enables download manager when set)
# The downloader should be on the same Docker network (pezzottify-internal)
# downloader_url = "http://downloader:3002"
downloader_timeout_sec = 300

# Event pruning
event_retention_days = 30
prune_interval_hours = 24

# Download Manager settings
# Enables queue-based content acquisition from external music providers.
# Requires downloader_url to be set. Set enabled = false to disable even with downloader_url.
[download_manager]
# Enable/disable the download manager (default: true when downloader_url is set)
enabled = true

# Rate Limiting
# Maximum albums a user can request per hour
max_albums_per_hour = 10
# Maximum albums a user can request per day
max_albums_per_day = 60
# Maximum requests a user can make per day (across all types)
user_max_requests_per_day = 100
# Maximum items a user can have in the queue at once
user_max_queue_size = 200

# Queue Processing
# Interval between queue processing ticks (seconds)
process_interval_secs = 5
# Time before in-progress items are flagged as stale (seconds)
stale_in_progress_threshold_secs = 3600

# Retry Settings
# Maximum retry attempts for failed downloads
max_retries = 8
# Initial delay before first retry (seconds)
initial_backoff_secs = 60
# Maximum delay between retries (seconds)
max_backoff_secs = 86400
# Multiplier for exponential backoff
backoff_multiplier = 2.5

# Audit Log
# Days to retain audit log entries (0 to disable cleanup)
audit_log_retention_days = 90

# Bandwidth Throttling
# Prevents overwhelming the downloader service
throttle_enabled = true
# Maximum MB per minute
throttle_max_mb_per_minute = 20
# Maximum MB per hour
throttle_max_mb_per_hour = 1500

# Corruption Handler
# Detects file corruption (ffprobe failures) and triggers downloader restarts
# Size of sliding window for tracking recent results
corruption_window_size = 4
# Number of failures in window that triggers restart
corruption_failure_threshold = 2
# Base cooldown duration in seconds after restart (level 0)
corruption_base_cooldown_secs = 600
# Maximum cooldown duration in seconds
corruption_max_cooldown_secs = 7200
# Multiplier for cooldown escalation (2.0 = double each level)
corruption_cooldown_multiplier = 2.0
# Successful downloads needed to de-escalate one level
corruption_successes_to_deescalate = 10

# Background Jobs settings
[background_jobs]
# Future: per-job configuration

# SSL/TLS settings (optional)
# Uncomment to enable HTTPS. Both cert_path and key_path are required.
# The metrics endpoint remains HTTP-only.
# [ssl]
# cert_path = "/path/to/cert.pem"
# key_path = "/path/to/key.pem"
